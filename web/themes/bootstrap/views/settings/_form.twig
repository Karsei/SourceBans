{% set form = this.beginWidget('CActiveForm', {
	'id': 'settings-form',
	'enableAjaxValidation': true,
	'enableClientValidation': true,
	'clientOptions': {
		'inputContainer': '.control-group',
		'validateOnSubmit': true,
	},
	'errorMessageCssClass': 'help-inline',
	'htmlOptions': {
		'class': 'form-horizontal',
	},
}) %}

<fieldset>
  <legend>{{ t('sourcebans', 'General') }}</legend>
  <div class="control-group">
    {{ form.label(model, 'language', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.dropDownList(model, 'language', SourceBans.app.languages) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'theme', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.dropDownList(model, 'theme', SourceBans.app.themes) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'default_page', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.dropDownList(model, 'default_page', {
        'dashboard': t('sourcebans', 'controllers.site.dashboard.title'),
        'bans': t('sourcebans', 'controllers.site.bans.title'),
        'servers': t('sourcebans', 'controllers.site.servers.title'),
        'submitban': t('sourcebans', 'controllers.site.submitban.title'),
        'protestban': t('sourcebans', 'controllers.site.protestban.title'),
      }) }}
    </div>
  </div>

  <div class="control-group">
    <div class="controls">
      {% set checkbox = form.checkBox(model, 'enable_submit') ~ model.getAttributeLabel('enable_submit') %}
      {{ C.Html.label(checkbox, 'SettingsForm_enable_submit', {'class': 'checkbox'}) }}
      {% set checkbox = form.checkBox(model, 'enable_protest') ~ model.getAttributeLabel('enable_protest') %}
      {{ C.Html.label(checkbox, 'SettingsForm_enable_protest', {'class': 'checkbox'}) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'timezone', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.dropDownList(model, 'timezone', LocaleData.getTimezones, {'class': 'span6'}) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'date_format', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.textField(model, 'date_format', {'size': 60, 'maxlength': 64, 'placeholder': 'm-d-y H:i'}) }}
      <div class="help-inline">{{ C.Html.link(t('sourcebans', 'See') ~ ': PHP date()', 'http://www.php.net/date', {'target': '_blank'}) }}</div>
    </div>
  </div>

  <div class="control-group">
    {{ form.labelEx(model, 'password_min_length', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.numberField(model, 'password_min_length', {'size': 60, 'maxlength': 64}) }}
      {{ form.error(model, 'password_min_length') }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'steam_web_api_key', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.textField(model, 'steam_web_api_key', {'size': 30, 'maxlength': 32, 'class': 'input-xlarge'}) }}
      {{ form.error(model, 'steam_web_api_key') }}
      <small class="help-block">
        {{ t('sourcebans', 'views.admin.settings.help.steam_web_api_key', {
          '{link}': C.Html.link('steamcommunity.com', 'http://www.steamcommunity.com/dev/apikey', {'target': '_blank'}),
        })|raw|nl2br }}
      </small>
    </div>
  </div>
</fieldset>

<fieldset>
  <legend>{{ t('sourcebans', 'controllers.site.dashboard.title') }}</legend>
  <div class="control-group">
    <div class="controls">
      {% set checkbox = form.checkBox(model, 'dashboard_blocks_popup') ~ model.getAttributeLabel('dashboard_blocks_popup') %}
      {{ C.Html.label(checkbox, 'SettingsForm_dashboard_blocks_popup', {'class': 'checkbox'}) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.labelEx(model, 'dashboard_title', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.textField(model, 'dashboard_title', {'class': 'span6', 'size': 60, 'maxlength': 256}) }}
      {{ form.error(model, 'dashboard_title') }}
    </div>
  </div>

  <div class="control-group">
    {% do this.widget('ext.tinymce.ETinyMce', {
      'model': model,
      'attribute': 'dashboard_text',
      'contentCSS': [
        App.assetManager.getPublishedUrl(Yii.getPathOfAlias('bootstrap.assets'), true) ~ '/css/bootstrap.min.css',
        App.assetManager.getPublishedUrl(Yii.getPathOfAlias('bootstrap.assets'), true) ~ '/css/yii.css',
        App.theme.baseUrl ~ '/css/style.css',
        App.theme.baseUrl ~ '/css/tinymce.css',
      ]|join(','),
      'editorTemplate': 'full',
      'height': '300px',
      'options': {
        'document_base_url': App.request.hostInfo ~ App.baseUrl ~ '/',
        'plugins': 'advhr,advimage,advlink,contextmenu,directionality,emotions,inlinepopups,media,nonbreaking,noneditable,paste,style,table,xhtmlxtras',
        'schema': 'html5',
        'theme_advanced_buttons1': 'bold,italic,underline,strikethrough,sub,sup,|,justifyleft,justifycenter,justifyright,justifyfull,|,forecolor,backcolor,formatselect,styleselect,styleprops,removeformat,|,advhr,charmap,emotions,image,media,|,code',
        'theme_advanced_buttons2': 'cut,copy,paste,|,undo,redo,|,bullist,numlist,outdent,indent,|,link,unlink,cite,abbr,acronym,ins,del,|,tablecontrols',
        'theme_advanced_buttons3': '',
        'theme_advanced_buttons4': '',
        'theme_advanced_resize_horizontal': false,
        'theme_advanced_resizing_min_height': 300,
      },
      'useSwitch': false,
      'width': '100%',
    }) %}
  </div>
</fieldset>

<fieldset>
  <legend>{{ t('sourcebans', 'controllers.site.bans.title') }}</legend>
  <div class="control-group">
    {{ form.labelEx(model, 'items_per_page', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.numberField(model, 'items_per_page', {'size': 60, 'maxlength': 64}) }}
      {{ form.error(model, 'items_per_page') }}
    </div>
  </div>

  <div class="control-group">
    <div class="controls">
      {% set checkbox = form.checkBox(model, 'bans_hide_admin') ~ model.getAttributeLabel('bans_hide_admin') %}
      {{ C.Html.label(checkbox, 'SettingsForm_bans_hide_admin', {'class': 'checkbox'}) }}
      {% set checkbox = form.checkBox(model, 'bans_hide_ip') ~ model.getAttributeLabel('bans_hide_ip') %}
      {{ C.Html.label(checkbox, 'SettingsForm_bans_hide_ip', {'class': 'checkbox'}) }}
      {% set checkbox = form.checkBox(model, 'bans_public_export') ~ model.getAttributeLabel('bans_public_export') %}
      {{ C.Html.label(checkbox, 'SettingsForm_bans_public_export', {'class': 'checkbox'}) }}
    </div>
  </div>
</fieldset>

<fieldset>
  <legend><?php echo Yii::t('sourcebans', 'Email') ?></legend>
  <div class="control-group">
    {{ form.label(model, 'mailer_from', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.textField(model, 'mailer_from', {'size': 60, 'maxlength': 256, 'placeholder': 'noreply@' ~ App.request.serverHost}) }}
      {{ form.error(model, 'mailer_from') }}
    </div>
  </div>

  <div class="control-group">
    <div class="controls">
      {% set checkbox = form.checkBox(model, 'enable_smtp') ~ model.getAttributeLabel('enable_smtp') %}
      {{ C.Html.label(checkbox, 'SettingsForm_enable_smtp', {'class': 'checkbox'}) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'smtp_host', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.textField(model, 'smtp_host', {'size': 60, 'maxlength': 256}) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'smtp_port', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.numberField(model, 'smtp_port', {'size': 60, 'maxlength': 64, 'placeholder': 25}) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'smtp_username', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.textField(model, 'smtp_username', {'size': 60, 'maxlength': 256}) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'smtp_password', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.passwordField(model, 'smtp_password', {'size': 60, 'maxlength': 256}) }}
    </div>
  </div>

  <div class="control-group">
    {{ form.label(model, 'smtp_secure', {'class': 'control-label'}) }}
    <div class="controls">
      {{ form.dropDownList(model, 'smtp_secure', {
        'ssl': 'SSL',
        'tls': 'TLS',
      }, {'empty': '- ' ~ t('sourcebans', 'None') ~ ' -'}) }}
    </div>
  </div>
</fieldset>

  <div class="control-group buttons">
    <div class="controls">
      {{ C.Html.submitButton(t('sourcebans', 'Save'), {'class': 'btn'}) }}
    </div>
  </div>

{% do this.endWidget %}

{% do App.clientScript.registerScript('settings_form', '
  $("#SettingsForm_enable_smtp").change(function() {
    $(":input[id^=\\"SettingsForm_smtp_\\"]").prop("disabled", !$(this).is(":checked"));
  }).trigger("change"); 
') %}